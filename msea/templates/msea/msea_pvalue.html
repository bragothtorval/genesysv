{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load static %}
{% get_static_prefix as STATIC_PREFIX %}


{% block title %}
    MSEA P-Value
{% endblock %}

{% block content %}
       <script>

            $("#main-nav-bar > ul > li.active").removeClass("active")
            $("#navbarId-Tools").addClass("active")
            $("#navbarId-msea-pvalue").addClass("active")
    </script>





    <div class="page-header">
        <h1>Ranked MSEA results</h1>
    </div>

    <div>
    <p>
    P-values of 0 are not simply extremely small p-values that are truncated / rounded to 0. They are a result of the method used in the <a target="_blank" href="http://doi.org/10.1186/s13059-014-0489-9">MSEA paper</a> and are akin to "more information needed." In the case of a p-value of 0, use the nes (normalized enrichment score) as a proxy. Please note that for nes, <u>higher</u> values are desired.
    </p>
    </div>

    <div>

        {{study_form|crispy}}

    </div>

    <div id="results">


    </div>


<script>

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function get_sorted_pvalues(selected_study){
        $.ajax(
            {
                headers: {'X-CSRFToken': getCookie('csrftoken')},
                type: "GET",
                url : "{% url 'msea-get-sorted-pvalues' %}",
                data: {
                        selected_study: selected_study,
                },
                success:function(data) {
                    // console.log(data)
                    $('#results').html(data);

                }
            }

        );
      };

    $( "#id_study" ).on("change", function(event) {
        var selected_study = $(this).find('option:selected').val();
        if (selected_study != '---') {
            get_sorted_pvalues(selected_study)
            // $('#results').html(selected_study);
        } else {
            console.log(selected_study)
            $('#results').html();
        }
    });

</script>


{% endblock %}


