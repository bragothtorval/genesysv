{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load subjectreport_tags %}


{% block head %}
{{ wizard.form.media }}
{% endblock %}

{% block content %}
<p>Step {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</p>

<form action="" method="post">{% csrf_token %}
    <ul class="list-inline">
        <li><button class="btn btn-default" name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}"><i class="fa fa-long-arrow-left"></i> Previous</button></li>
        <li><button class="btn btn-success" name="wizard_goto_step" type="submit" value="Next"><i class="fa fa-file-pdf-o" aria-hidden="true"></i> Generate PDF </button></li>
    </ul>

    {{ wizard.management_form|crispy }}
    {% if wizard.form.forms %}
        {{ wizard.form.management_form|crispy }}
        {% for form in wizard.form.forms %}
            {{ form|crispy }}
        {% endfor %}
    {% else %}
        <div class="panel panel-primary">
            <div class="panel-body">
                {% if relevant_findings %}
            <h3>Selected: Variants Relevant to Indicated for Finding ({{relevant_findings|length}}) </h3>
            <div class="table-responsive">
                <table id="relevant_findings" class="table display compact table-striped" cellspacing="0" width="100%">
                            <thead>
                              <tr>
                                <th>Variant ID</th>
                                <th>Allele Frequency</th>
                                <th>Zygosity</th>
                                <th>Gene</th>
                                <th>RefSeq ID</th>
                                <th>Variant</th>
                                <th>ClinVar</th>
                                <th>ClinVar Classification</th>
                                <th>GWAS Catalog</th>
                              </tr>
                            </thead>
                            <tbody>
                        {% for finding in relevant_findings %}
                            <tr>
                                <td>{{finding.1}}</td>
                                <td>{{finding.2}}</td>
                                <td>{{finding.3}}</td>
                                <td>{{finding.4}}</td>
                                <td>{{finding.5 |addbrarrayremoveslash |safe}}</td>
                                <td>{{finding.6 |addbrarray |safe }}</td>
                                <td nowrap>
                                    {% for clinvar, clinsig in finding.7 %}
                                        {{clinvar}} <br>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for clinvar, clinsig in finding.7 %}
                                        {{clinsig}} <br>
                                    {% endfor %}
                                </td>
                                <td nowrap>{{finding.8|addbrstring|safe}}</td>
                        {% endfor %}
                        </tbody>
                         </table>
            </div>
         {% endif %}

    {% if incidental_findings %}
            <h3>Selected: Other Variants of Medical Significance (Incidental Findings) ({{incidental_findings|length}}) </h3>
            <div class="table-responsive">
                <table id="incidental_findings" class="table display compact table-striped" cellspacing="0" width="100%">
                            <thead>
                               <tr>
                                <th>Variant ID</th>
                                <th>Allele Frequency</th>
                                <th>Zygosity</th>
                                <th>Gene</th>
                                <th>RefSeq ID</th>
                                <th>Variant</th>
                                <th>ClinVar</th>
                                <th>ClinVar Classification</th>
                                <th>GWAS Catalog</th>
                              </tr>
                            </thead>
                            <tbody>
                                {% for finding in incidental_findings %}
                                     <tr>
                                        <td nowrap>{{finding.1}}</td>
                                        <td>{{finding.2}}</td>
                                        <td>{{finding.3}}</td>
                                        <td>{{finding.4}}</td>
                                        <td>{{finding.5 |addbrarrayremoveslash |safe}}</td>
                                        <td>{{finding.6 |addbrarray |safe }}</td>
                                        <td nowrap>
                                            {% for clinvar, clinsig in finding.7 %}
                                                {{clinvar}} <br>
                                            {% endfor %}
                                        </td>
                                        <td>
                                            {% for clinvar, clinsig in finding.7 %}
                                                {{clinsig}} <br>
                                            {% endfor %}
                                        </td>
                                        <td nowrap>{{finding.8|addbrstring|safe}}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                         </table>
                    </div>

         {% endif %}
          </div>
    </div>

    {% endif %}

    {{ wizard.form|crispy }}
    <ul class="list-inline">
        <li><button class="btn btn-default" name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}"><i class="fa fa-long-arrow-left"></i> Previous</button></li>
        <li><button class="btn btn-success" name="wizard_goto_step" type="submit" value="Next"><i class="fa fa-file-pdf-o" aria-hidden="true"></i> Generate PDF </button></li>
    </ul>
</form>
<p>Step {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</p>
<br>


{% endblock %}



