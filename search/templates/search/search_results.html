
{% load crispy_forms_tags %}
{% load search_tags %}
{% load staticfiles %}
{% load humanize %}

{% block title %}
    Search
{% endblock %}


{% block content %}
<h4>Total Hits: {{total|intcomma}}</h4>
<h4>Query String Generation Time: {{content_generate_time}}</h4>
<h4>Database Took: {{took}} ms</h4>
<h4>Post Processing Time: {{after_results_time}}</h4>
<h4>Total Time: {{total_time}}</h4>

{% for ele in used_keys %}
    {{ele.0}}: <strong>{{ele.1}}</strong><br>
{% endfor %}

<br>

<div class="well">
    <a class="btn btn-primary back_to_top_container" role="button"><i class="fa fa-long-arrow-left" aria-hidden="true"></i> Back</a>
    <a class="btn btn-primary " role="button" href="/search">New Search</a>
    {% if user.is_authenticated %}
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal"><i class="fa fa-star" aria-hidden="true"></i> Save Search Results</button>
    {% endif %}
    <a class="btn btn-primary pull-right download-results" role="button" href="#"><i class="fa fa-download" aria-hidden="true"></i> Download</a>
    <form id="download-form" role="form"  method="POST" action="{% url 'search-result-download' %}">
        {% csrf_token %}
        <input style="display: none;" type="hidden" name="search_result_download_obj_id" value="{{search_result_download_obj_id}}">
    </form>
    <div class="clearfix"></div>
</div>


<div class="panel panel-primary">
<div class="panel-body">
<div class="table-responsive">
    <table id="result-table" class="table display compact" cellspacing="0" width="100%">
        <thead>
          <tr>
            {% for element in headers %}
                <th>{{element.display_name}}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
            {% for row in results %}
                <tr>
                    {% for element in headers %}
                        <td>{{ row|get_value_from_dict:element.es_name|safe }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

</div>
</div>

<br>

<br>

<script>
    $(document).ready(function() {
        $('#result-table').DataTable({
            "iDisplayLength": 25,
            "bSortClasses": false
        });

    });

    $(".download-results").on("click", function() {
        $("#download-form").submit();
    });


</script>

{% endblock %}
